@page "/"
@using Econ.Services
@using FluentUI.Components.Stores
@rendermode InteractiveServer
@ServerId
<PageTitle>Home</PageTitle>
<FluentMenuButton @ref=menubutton Text="Select server" OnMenuChanged="HandleOnMenuChanged">
    @foreach (var item in items)
    {
        <FluentMenuItem Id="@item.Key">@item.Value</FluentMenuItem>
    }
</FluentMenuButton>

@code {
    [Inject] 
    private SpaceEngineersServerService serverService { get; set; }
    private FluentMenuButton menubutton = new();
    private StoresTransactionsComponent TransactionsComponent;
    private LiveStoreDataComponent LiveData;
    private Guid ServerId;

    protected override async Task OnInitializedAsync()
    {
        serverService.ServersChanged += async () => { await SetupButton(); };


        await InvokeAsync(StateHasChanged);
    }

    private async Task SetupButton()
    {
        foreach (var item in serverService.GetServers())
        {
            items[item.ServerId.ToString()] = item.ServerName;
        }

     //   await InvokeAsync(StateHasChanged);
    }

    private Dictionary<string, string> items = new Dictionary<string, string>();

    private async Task HandleOnMenuChanged(MenuChangeEventArgs args)
    {
        ServerId = Guid.Parse(args.Id);
        TransactionsComponent.ServerId = ServerId;
        await TransactionsComponent.LoadData();
        await LiveData.LoadData(ServerId);
    }

}

<FluentUI.Components.Stores.StoresTransactionsComponent @ref=@TransactionsComponent ServerId="@ServerId"></FluentUI.Components.Stores.StoresTransactionsComponent> 
<FluentUI.Components.Stores.LiveStoreDataComponent @ref=@LiveData ServerId="@ServerId"></FluentUI.Components.Stores.LiveStoreDataComponent> 